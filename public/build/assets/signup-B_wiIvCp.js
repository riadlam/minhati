function M(){document.querySelectorAll("#signupForm .form-group").forEach(d=>{const l=d.querySelector("input[required], select[required], textarea[required]"),v=d.querySelector("label");if(l&&!l.disabled&&v&&!v.querySelector(".text-danger")){const u=document.createElement("span");u.className="text-danger",u.textContent=" *",v.appendChild(u)}})}const O=new Date("2026-03-01T00:00:00");function j(){const d=document.getElementById("signupForm"),l=document.getElementById("deadlineAlert");if(!d)return;const u=new Date>=O;l&&l.classList.toggle("d-none",!u),u&&d.querySelectorAll("input, select, textarea, button").forEach(p=>{p.type!=="hidden"&&(p.disabled=!0)})}document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("wilayaSelectSignup"),l=document.getElementById("communeSelectSignup");if(d&&l){async function n(){try{d.innerHTML='<option value="">جارٍ التحميل...</option>';const e=await(await fetch("/api/wilayas")).json(),t=Array.isArray(e)?e:e.data||[];d.innerHTML='<option value="">اختر...</option>',Array.isArray(t)&&t.forEach(r=>{d.innerHTML+=`<option value="${r.code_wil}">${r.lib_wil_ar}</option>`})}catch(a){console.error("خطأ في تحميل الولايات:",a),d.innerHTML='<option value="">تعذر تحميل البيانات</option>'}}async function s(a){try{l.innerHTML='<option value="">جارٍ التحميل...</option>',l.disabled=!0;const t=await(await fetch(`/api/communes/by-wilaya/${a}`)).json(),r=Array.isArray(t)?t:t.data||[];l.innerHTML='<option value="">اختر...</option>',Array.isArray(r)&&r.forEach(i=>{l.innerHTML+=`<option value="${i.code_comm}">${i.lib_comm_ar}</option>`}),l.disabled=!1}catch(e){console.error("خطأ في تحميل البلديات:",e),l.innerHTML='<option value="">تعذر تحميل البيانات</option>'}}d.addEventListener("change",a=>{const e=a.target.value;e?s(e):(l.innerHTML='<option value="">اختر الولاية أولا...</option>',l.disabled=!0)}),n()}const v=document.getElementById("wilaya_carte"),u=document.getElementById("commune_carte");if(v&&u){async function n(){try{v.innerHTML='<option value="">جارٍ التحميل...</option>';const e=await(await fetch("/api/wilayas")).json(),t=Array.isArray(e)?e:e.data||[];v.innerHTML='<option value="">-- اختر الولاية --</option>',Array.isArray(t)&&t.forEach(r=>v.innerHTML+=`<option value="${r.code_wil}">${r.lib_wil_ar}</option>`)}catch(a){console.error("خطأ في تحميل ولايات البطاقة:",a),v.innerHTML='<option value="">تعذر تحميل البيانات</option>'}}async function s(a){try{u.innerHTML='<option value="">جارٍ التحميل...</option>',u.disabled=!0;const t=await(await fetch(`/api/communes/by-wilaya/${a}`)).json(),r=Array.isArray(t)?t:t.data||[];u.innerHTML='<option value="">-- اختر البلدية --</option>',Array.isArray(r)&&r.forEach(i=>u.innerHTML+=`<option value="${i.code_comm}">${i.lib_comm_ar}</option>`),u.disabled=!1}catch(e){console.error("خطأ في تحميل بلديات البطاقة:",e),u.innerHTML='<option value="">تعذر تحميل البيانات</option>'}}v.addEventListener("change",a=>{const e=a.target.value;e?s(e):(u.innerHTML='<option value="">اختر الولاية أولا...</option>',u.disabled=!0)}),n()}const p=document.getElementById("categorie_sociale"),b=document.getElementById("montant_s_wrapper"),S=document.getElementById("montant_s");p&&b&&S&&p.addEventListener("change",function(){this.value==="الدخل الشهري أقل أو يساوي مبلغ الأجر الوطني الأدنى المضمون"?(b.style.display="block",S.required=!0):(b.style.display="none",S.required=!1,S.value="")}),M();const C=document.querySelectorAll(".form-step"),I=document.querySelectorAll(".next-step"),D=document.querySelectorAll(".prev-step"),B=document.getElementById("progress"),q=document.querySelectorAll(".progress-step");let g=0;function k(){C.forEach((n,s)=>n.classList.toggle("active",s===g)),q.forEach((n,s)=>n.classList.toggle("active",s<=g)),B.style.width=g/(q.length-1)*100+"%",A(),F()}function f(n,s){if(o(n),!s)return;const a=document.createElement("div");a.className="error-message",a.textContent=s,(n.closest(".password-wrapper")||n).insertAdjacentElement("afterend",a),n.classList.add("invalid"),n.classList.remove("valid")}function $(n){o(n),n.classList.add("valid"),n.classList.remove("invalid")}function o(n){(n.closest(".password-wrapper")||n).parentNode.querySelectorAll(".error-message").forEach(e=>e.remove())}window.setupMotherArabicValidation=function(n){const s=document.getElementById(`mother_${n}_nom_ar`),a=document.getElementById(`mother_${n}_prenom_ar`);[s,a].forEach(e=>{if(!e)return;const t=/^[\u0600-\u06FF\s]+$/;e.addEventListener("keypress",function(r){const i=r.key;/^[\u0600-\u06FF\s]$/.test(i)||(r.preventDefault(),f(this,"يرجى الإدخال باللغة العربية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))}),e.addEventListener("input",function(){const r=this.value.trim();if(r===""){o(this),this.classList.remove("valid","invalid");return}t.test(r)?(o(this),this.classList.add("valid"),this.classList.remove("invalid")):(f(this,"يرجى الإدخال باللغة العربية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))}),e.addEventListener("blur",function(){const r=this.value.trim();if(r===""){o(this),this.classList.remove("valid","invalid");return}t.test(r)||(f(this,"يرجى الإدخال باللغة العربية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))})})},window.setupMotherNINValidation=function(n){const s=document.getElementById(`mother_${n}_nin`);if(!s)return;let a=null;s.addEventListener("keypress",function(e){[8,9,27,13,46].indexOf(e.keyCode)!==-1||e.keyCode===65&&e.ctrlKey===!0||e.keyCode===67&&e.ctrlKey===!0||e.keyCode===86&&e.ctrlKey===!0||e.keyCode===88&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39||((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault(),this.value.length>=18&&e.preventDefault())}),s.addEventListener("input",function(){this.value=this.value.replace(/\D/g,""),this.value.length>18&&(this.value=this.value.slice(0,18));const e=this.value.trim();if(a&&clearTimeout(a),e===""){o(this),this.classList.remove("valid","invalid");return}e.length===18?(a=setTimeout(async()=>{try{(await(await fetch("/api/check/mother/nin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({nin:e})})).json()).exists?(f(s,"هذا الرقم الوطني موجود بالفعل"),s.classList.add("invalid"),s.classList.remove("valid")):(o(s),s.classList.add("valid"),s.classList.remove("invalid"))}catch(t){console.error("Error checking NIN:",t),o(s),s.classList.add("valid"),s.classList.remove("invalid")}},500),o(s),s.classList.remove("invalid")):(f(this,`الرقم الوطني يجب أن يحتوي على 18 رقمًا (${e.length}/18)`),this.classList.add("invalid"),this.classList.remove("valid"))}),s.addEventListener("blur",async function(){const e=this.value.trim();if(e===""){o(this),this.classList.remove("valid","invalid");return}if(e.length!==18)f(this,"الرقم الوطني يجب أن يحتوي على 18 رقمًا"),this.classList.add("invalid"),this.classList.remove("valid");else try{(await(await fetch("/api/check/mother/nin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({nin:e})})).json()).exists?(f(this,"هذا الرقم الوطني موجود بالفعل"),this.classList.add("invalid"),this.classList.remove("valid")):(o(this),this.classList.add("valid"),this.classList.remove("invalid"))}catch(t){console.error("Error checking NIN:",t),o(this),this.classList.add("valid"),this.classList.remove("invalid")}})},window.setupMotherNSSValidation=function(n){const s=document.getElementById(`mother_${n}_nss`);if(!s)return;let a=null;s.addEventListener("keypress",function(e){[8,9,27,13,46].indexOf(e.keyCode)!==-1||e.keyCode===65&&e.ctrlKey===!0||e.keyCode===67&&e.ctrlKey===!0||e.keyCode===86&&e.ctrlKey===!0||e.keyCode===88&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39||((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault(),this.value.length>=12&&e.preventDefault())}),s.addEventListener("paste",function(e){e.preventDefault();const r=(e.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"").slice(0,12);this.value=r,this.dispatchEvent(new Event("input"))}),s.addEventListener("input",function(){this.value=this.value.replace(/\D/g,""),this.value.length>12&&(this.value=this.value.slice(0,12));const e=this.value.trim();if(a&&clearTimeout(a),e===""){o(this),this.classList.remove("valid","invalid");return}e.length===12?(a=setTimeout(async()=>{try{(await(await fetch("/api/check/mother/nss",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({nss:e})})).json()).exists?(f(s,"هذا رقم الضمان الاجتماعي موجود بالفعل"),s.classList.add("invalid"),s.classList.remove("valid")):(o(s),s.classList.add("valid"),s.classList.remove("invalid"))}catch(t){console.error("Error checking NSS:",t),o(s),s.classList.add("valid"),s.classList.remove("invalid")}},500),o(s),s.classList.remove("invalid")):(f(this,`رقم الضمان الاجتماعي يجب أن يحتوي على 12 رقمًا (${e.length}/12)`),this.classList.add("invalid"),this.classList.remove("valid"))}),s.addEventListener("blur",async function(){const e=this.value.trim();if(e===""){o(this),this.classList.remove("valid","invalid");return}if(e.length!==12)f(this,"رقم الضمان الاجتماعي يجب أن يحتوي على 12 رقمًا"),this.classList.add("invalid"),this.classList.remove("valid");else try{(await(await fetch("/api/check/mother/nss",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||""},body:JSON.stringify({nss:e})})).json()).exists?(f(this,"هذا رقم الضمان الاجتماعي موجود بالفعل"),this.classList.add("invalid"),this.classList.remove("valid")):(o(this),this.classList.add("valid"),this.classList.remove("invalid"))}catch(t){console.error("Error checking NSS:",t),o(this),this.classList.add("valid"),this.classList.remove("invalid")}})};function L(n,s=!0){if(n.disabled)return o(n),n.classList.remove("invalid","valid"),!0;const a=n.value.trim(),e=n.id,t=n.type,r=n.name;o(n);let i=!0,c="";if(t==="radio"){const _=document.querySelectorAll(`input[name="${r}"]`),m=document.querySelector(`input[name="${r}"]:checked`),y=n.closest(".form-group");if(y&&y.querySelectorAll(".error-message").forEach(h=>h.remove()),!m&&(i=!1,c="هذا الحقل مطلوب",s&&y)){const h=document.createElement("div");h.className="error-message",h.textContent=c,y.appendChild(h)}return _.forEach(h=>{h.classList.toggle("valid",i),h.classList.toggle("invalid",!i)}),i}if(n.tagName.toLowerCase()==="select"&&n.hasAttribute("required")&&(a===""||a==="none")&&(i=!1,c="هذا الحقل مطلوب"),n.hasAttribute("required")&&a===""&&(i=!1,c="هذا الحقل مطلوب"),i&&a!=="")switch(e){case"nin":/^\d{18}$/.test(a)||(i=!1,c="يجب أن يحتوي الرقم التعريفي الوطني على 18 رقمًا بالضبط");break;case"email":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)||(i=!1,c="البريد الإلكتروني غير صالح");break;case"phone":/^\d{10}$/.test(a)||(i=!1,c="رقم الهاتف يجب أن يحتوي على 10 أرقام");break;case"password":/^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/.test(a)||(i=!1,c="كلمة المرور ضعيفة، يجب أن تحتوي على حرف كبير، رقم، ورمز خاص");break;case"confirm_password":const _=document.getElementById("password").value;a!==_&&(i=!1,c="كلمة المرور غير مطابقة");break;case"date_naissance":const m=new Date;new Date(a)>m&&(i=!1,c="تاريخ الميلاد لا يمكن أن يكون في المستقبل");break;case"num_carte":/^\d{9}$/.test(a)||(i=!1,c="يجب أن يحتوي رقم بطاقة التعريف الوطنية على 9 أرقام");break;case"date_carte":const h=new Date;h.setHours(0,0,0,0);const T=new Date(a);if(T>h)i=!1,c="تاريخ إصدار البطاقة يجب أن يكون قبل أو يساوي تاريخ اليوم";else{const E=new Date;E.setFullYear(h.getFullYear()-10),E.setHours(0,0,0,0),T<E&&(i=!1,c="تاريخ إصدار البطاقة يجب ألا يتجاوز 10 سنوات من تاريخ اليوم")}break;case"nss":/^\d{12}$/.test(a)||(i=!1,c="رقم الضمان الاجتماعي يجب أن يحتوي على 12 رقمًا بالضبط");break;case"montant_s":if(document.getElementById("categorie_sociale").value!=="عديم الدخل"){const E=parseFloat(a);isNaN(E)||E<=0?(i=!1,c="يرجى إدخال مبلغ صالح (أكبر من 0)"):n.value=E}else n.value="0",i=!0,o(n);break;case"num_cp":/^\d{10}$/.test(a)||(i=!1,c="رقم الحساب البريدي يجب أن يحتوي على 10 أرقام");break;case"cle_ccp":/^\d{2}$/.test(a)||(i=!1,c="الرقم المفتاح يجب أن يحتوي على رقمين اثنين");break}return i?$(n):s?f(n,c):n.classList.remove("valid","invalid"),i}const x=document.getElementById("phone");x&&x.addEventListener("input",function(){const n=this.value.replace(/\D/g,"");this.value!==n?f(this,"يجب إدخال أرقام فقط"):n.length>0&&n.length!==10?f(this,"رقم الهاتف يجب أن يحتوي على 10 أرقام"):(o(this),this.classList.add("valid"),this.classList.remove("invalid")),this.value=n.slice(0,10)}),["nom_ar","prenom_ar"].forEach(n=>{const s=document.getElementById(n);if(!s)return;const a=/^[\u0600-\u06FF\s]+$/;s.addEventListener("keypress",function(e){const t=e.key;/^[\u0600-\u06FF\s]$/.test(t)||(e.preventDefault(),f(this,"يرجى الإدخال باللغة العربية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))}),s.addEventListener("input",function(){const e=this.value.trim();if(e===""){o(this),this.classList.remove("valid","invalid");return}a.test(e)?(o(this),this.classList.add("valid"),this.classList.remove("invalid")):(f(this,"يرجى الإدخال باللغة العربية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))})}),["nom_fr","prenom_fr"].forEach(n=>{const s=document.getElementById(n);if(!s)return;const a=/^[A-Za-zÀ-ÿ\s]+$/;s.addEventListener("keypress",function(e){const t=e.key;/^[\u0600-\u06FF]$/.test(t)&&(e.preventDefault(),f(this,"يرجى الإدخال بالحروف اللاتينية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))}),s.addEventListener("input",function(){const e=this.value.trim();if(e===""){o(this),this.classList.remove("valid","invalid");return}a.test(e)?(o(this),this.classList.add("valid"),this.classList.remove("invalid")):(f(this,"يرجى الإدخال بالحروف اللاتينية فقط"),this.classList.add("invalid"),this.classList.remove("valid"))})});function A(){const n=document.querySelectorAll(".form-step.active input, .form-step.active select"),s=document.getElementById("categorie_sociale"),a=document.getElementById("montant_s"),e=document.getElementById("montant_s_wrapper");s&&a&&e&&(s._changeHandler&&s.removeEventListener("change",s._changeHandler),s._changeHandler=function(){this.value==="الدخل الشهري أقل أو يساوي مبلغ الأجر الوطني الأدنى المضمون"?(e.style.display="block",a.removeAttribute("disabled"),a.setAttribute("required","required"),a.value=""):(e.style.display="none",a.value="",a.removeAttribute("required"),a.removeAttribute("disabled"),a.classList.remove("valid","invalid"),o(a))},s.addEventListener("change",s._changeHandler),s._changeHandler()),n.forEach(t=>{t.removeEventListener("input",t._inputHandler),t.removeEventListener("blur",t._blurHandler),t.id==="nin"&&t.addEventListener("input",()=>{t.value=t.value.replace(/\D/g,"").slice(0,18)}),t.id==="num_carte"&&t.addEventListener("input",()=>{t.value=t.value.replace(/\D/g,"").slice(0,9)}),t.id==="nss"&&t.addEventListener("input",()=>{t.value=t.value.replace(/\D/g,"").slice(0,12)}),t.id==="montant_s"&&t.addEventListener("input",()=>{parseFloat(t.value)<0&&(t.value="")}),t.id==="num_cp"&&t.addEventListener("input",()=>{t.value=t.value.replace(/\D/g,"").slice(0,10)}),t.id==="cle_ccp"&&t.addEventListener("input",()=>{t.value=t.value.replace(/\D/g,"").slice(0,2)}),t.id==="date_carte"?(t.addEventListener("change",()=>{t.value.trim()!==""&&L(t,!0)}),t._inputHandler=()=>{t.value.trim()!==""&&L(t,!0)}):t._inputHandler=()=>{t.value.trim()!==""&&L(t,!1)},t.addEventListener("input",t._inputHandler),t._blurHandler=()=>{t.value.trim()!==""&&L(t,!0)},t.addEventListener("blur",t._blurHandler)})}function F(){const n=document.getElementById("categorie_sociale"),s=document.getElementById("montant_s"),a=document.getElementById("montant_s_wrapper");n&&s&&a&&(n.value==="عديم الدخل"||n.value===""?(a.style.display="none",s.value="",s.removeAttribute("required"),o(s)):n.value==="الدخل الشهري أقل أو يساوي مبلغ الأجر الوطني الأدنى المضمون"&&(a.style.display="block",s.removeAttribute("disabled"),s.setAttribute("required","required"),s.value==="0"&&(s.value="")))}function H(){const n=document.querySelector(".form-step.active"),s=n.querySelectorAll("input[required], select[required]");let a=!0,e=[];return n.querySelectorAll(".error-message").forEach(t=>t.remove()),s.forEach(t=>{const r=t.closest("#montant_s_wrapper");if(!(r&&window.getComputedStyle(r).display==="none")&&!L(t,!0)){a=!1;const i=t.closest(".form-group")?.querySelector("label")?.textContent||t.name;e.push(i)}}),s.forEach(t=>{if(!(t.disabled&&t.id!=="montant_s")&&!L(t,!0)){a=!1;const r=t.closest(".form-group")?.querySelector("label")?.textContent||t.name;e.includes(r)||e.push(r)}}),!a&&typeof Swal<"u"&&Swal.fire({icon:"warning",title:"يرجى إكمال البيانات",html:`الحقول التالية مطلوبة أو تحتوي على أخطاء:<br><b>${e.join("<br>")}</b>`,confirmButtonText:"حسنًا"}),a}I.forEach(n=>{n.addEventListener("click",()=>{(g===0||g===1)&&!H()||g<C.length-1&&(g++,k())})}),D.forEach(n=>{n.addEventListener("click",()=>{g>0&&(g--,k())})});const w=document.getElementById("signupForm");function N(n,s){if(n=n.trim(),s=s.trim(),!/^\d+$/.test(n)||!/^\d+$/.test(s))return!1;const e=parseInt(n,10)*100%97,r=(97-(e+85>97?e+85-97:e+85)).toString().padStart(2,"0");return s===r}w&&(w.noValidate=!0,w.addEventListener("submit",async n=>{n.preventDefault();let s=!0,a=[];document.querySelectorAll(".error-message").forEach(m=>m.remove()),w.querySelectorAll("input[required], select[required]").forEach(m=>{if(!L(m,!0)){s=!1;const y=m.closest(".form-group, .col-md-3")?.querySelector("label")?.textContent||m.name;a.includes(y)||a.push(y)}});const t=w.querySelector('input[name="gender"]:checked');t||(s=!1,a.includes("الجنس")||a.push("الجنس"));const r=document.getElementById("agreement_checkbox");if(!r||!r.checked?(s=!1,a.includes("الموافقة على القوانين")||a.push("الموافقة على القوانين"),r&&(r.style.outline="2px solid #ef4444",r.style.outlineOffset="2px")):r&&(r.style.outline="",r.style.outlineOffset=""),!s){Swal.fire({icon:"warning",title:"يرجى إكمال البيانات",html:`الحقول التالية مطلوبة أو تحتوي على أخطاء:<br><b>${a.join("<br>")}</b>`,confirmButtonText:"حسنًا"});return}const i=Object.fromEntries(new FormData(w).entries()),c={nin:i.nin,email:i.email,tel:i.phone,password:i.password,nom_ar:i.nom_ar,prenom_ar:i.prenom_ar,nom_fr:i.nom_fr,prenom_fr:i.prenom_fr,sexe:t.value==="male"?"ذكر":"أنثى",date_naiss:i.date_naissance,presume:i.presume?"1":"0",commune_naiss:document.getElementById("communeSelectSignup")?.value||null,adresse:i.adresse,nbr_enfants_scolarise:i.nbr_enfants,num_cni:i.num_carte,date_cni:i.date_carte,lieu_cni:document.getElementById("commune_carte")?.value||null,nss:i.nss,num_cpt:i.num_cp,cle_cpt:i.cle_ccp,cats:i.categorie_sociale,montant_s:i.categorie_sociale==="الدخل الشهري أقل أو يساوي مبلغ الأجر الوطني الأدنى المضمون"&&i.montant_s||null,autr_info:i.autre_info||"",code_commune:document.getElementById("communeSelectSignup")?.value||null};if(!N(c.num_cpt,c.cle_cpt)){Swal.fire({icon:"warning",title:" CCP خطأ في",text:"رقم CCP أو مفتاح CCP غير صحيح. يرجى التحقق.",confirmButtonText:"حسنًا"});return}const _=new FormData;for(const m in c)c[m]!==void 0&&c[m]!==null&&_.append(m,c[m]);try{Swal.fire({title:"جاري الإرسال...",text:"الرجاء الانتظار قليلاً",allowOutsideClick:!1,didOpen:()=>Swal.showLoading()});const m=await fetch("/api/tuteurs",{method:"POST",body:_,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"}}),y=await m.json();if(Swal.close(),m.status===422){const h=Object.values(y.errors||{}).flat().join("<br>");Swal.fire({icon:"warning",title:"تحقق من البيانات",html:h,confirmButtonText:"حسنًا",customClass:{confirmButton:"swal-confirm-btn"},buttonsStyling:!1});return}if(!m.ok){Swal.fire({icon:"error",title:"حدث خطأ أثناء التسجيل",text:y.message||"يرجى المحاولة لاحقًا.",confirmButtonText:"حسنًا",customClass:{confirmButton:"swal-confirm-btn"},buttonsStyling:!1});return}Swal.fire({icon:"success",title:"✅ تم التسجيل بنجاح!",text:"يمكنك الآن تسجيل الدخول إلى حسابك.",confirmButtonText:"حسنًا",customClass:{confirmButton:"swal-confirm-btn"},buttonsStyling:!1}).then(()=>{window.location.href="/login"})}catch(m){console.error("❌ Fetch error:",m),Swal.close(),Swal.fire({icon:"error",title:"خطأ في الاتصال بالخادم",text:"تحقق من الاتصال بالخادم المحلي أو الشبكة."})}})),j(),A(),k()});document.querySelectorAll(".toggle-password").forEach(d=>{d.addEventListener("click",()=>{const l=d.closest(".password-wrapper").querySelector("input");l.type==="password"?(l.type="text",d.classList.replace("fa-eye","fa-eye-slash")):(l.type="password",d.classList.replace("fa-eye-slash","fa-eye"))})});window.toggleAgreementText=function(){const d=document.querySelector(".agreement-text-short"),l=document.querySelector(".agreement-text-full"),v=document.querySelector(".read-more-text"),u=document.querySelector(".read-less-text"),p=document.querySelector(".read-more-btn");d&&l&&v&&u&&p&&(l.style.display!=="none"&&l.style.display!==""?(d.style.display="block",l.style.display="none",v.style.display="inline",u.style.display="none",p.classList.remove("active")):(d.style.display="none",l.style.display="block",v.style.display="none",u.style.display="inline",p.classList.add("active")))};
